# XSS攻击
## 什么是XSS攻击？
XSS是 Cross-Site Scripting（跨站脚本攻击）的简称,为了和 CSS 区分，所以把攻击的第一个字母改为 X。
是一种代码注入攻击。攻击者通过在在网站注入恶意脚本，使之在用户的浏览器上运行，从而对用户浏览器进行控制或者盗取用户的信息如 cookie 等
恶意脚本一般包括 JavaScript，有时也会包含 HTML 和 Flash。攻击方式有很多种，但他们的共同点为：将一些隐私数据像 cookie、session 发送给攻击者，将受害者从定位到一个由攻击者控制的网站，在受害者的机器上进行一些恶意操作。


## XSS 分类
根据攻击的来源，可以分为存储型、反射型、DOM型。

| 类型      | 存储区                  | 插入点          |
| --------- | ----------------------- | --------------- |
| 反射型 XSS | URL                     | HTML            |
| 存储型 XSS | 后端数据库              | HTML            |
| DOM 型 XSS  | 后端数据库/前端存储/URL | 前端/JavaScript |


### 反射型 XSS
反射型指的是：攻击者构建了特殊的 URL，当服务器接收到请求后，从 URL 中获取数据，拼接到 HTML 后返回，从而导致恶意代码的执行。

低危漏洞



### 存储型 XSS
存储型指的是：攻击者将恶意代码提交到了网站的数据库中，当用户请求数据的时候，服务器将其拼接为 HTML 后返回给了用户，从而导致了恶意代码的执行。

高危漏洞


### DOM 型 XSS
DOM 型指的是：攻击者构建了特殊的 URL，用户打开网站后， js 脚本 从 URL 中获取数据，从而导致了恶意代码的执行。
类似于反射型，区别在于 DOM 型 XSS 并不会和后台进行交互，前端直接将 URL 中的数据不做处理并动态插入到 HTML中，是纯粹的前端安全问题，要做防御也只能在客户端上进行防御。

低低危漏洞


## 防范措施

### HttpOnly
浏览器将禁止页面的 JavaScript 访问带有 HttpOnly 属性的 Cookie
就是服务器在 setCookie 的时候，设置 HttpOnly；

它解决的是 XSS 后 Cookie 劫持问题。就是无法拿到这种类型的 Cookie。

### 输入检查
原则：**不要相信用户的任何输入**。

措施：对于用户的任何输入要进行检查、过滤、转义。建立可信任的字符和 HTML 标签白名单，对于不在白名单之列的字符或者标签进行过滤或编码。

说明：而在一些前端框架中，都会有一份 decodingMap， 用于对用户输入所包含的特殊字符或标签进行编码或过滤，如 <，>，script，防止 XSS 攻击。


### 输出检查
一般说来，所有需要输出到 HTML 页面的变量，全部需要使用编码或者转义来防御。
措施：对内容进行编码或者转义。




## React 如何防范 XSS 攻击
React DOM 在渲染所有输入内容之前，默认会进行转义。
所有的内容在渲染之前都被转换成了字符串，因此恶意代码无法成功注入，从而有效地防止了 XSS 攻击。我们具体看下：

但是有一个需要自己考虑 `dangerouslySetInnerHTML` 
```javascript
 <p
  dangerouslySetInnerHTML={{
    __html: getURL(dialogData.content),
  }}
 />
```

